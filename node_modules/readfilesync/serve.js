let fs = require('fs')
let express = require('express')
let childProcess = require('child_process');
const path = require('path')
let app = express()
// let pathname = path.join(__dirname,'/templatse')
// 设置模板引擎
app.set('view engine', 'ejs')  //设置express使用的模板引擎作用
app.set('views', __dirname + '/templatse')   //设置模板文件的存放位置

// 因为已经定义了ejs模板引擎所以这个没什么多大用
// 静态资源文件
// app.use(express.static(process.cwd()));

let pathRout = process.cwd()

app.use((req, res) => {
    if (req.path.includes('favicon.ico')) {
        return//返回根目录
    }
    console.log(req.path); 
    pathRout = path.join(process.cwd(), req.path);

    let fileList = fs.readdirSync(pathRout)
    let result = []
    fileList.forEach((item, index) => {
        let flag = fs.statSync(path.join(pathRout, item)).isDirectory();
        result.push({ item, type: flag ? 0 : 1 })
    })
    // 设置模板名称
    res.render('index', { result })
})

app.listen(3000, () => {
    if (process.platform === 'win32') {
        childProcess.exec('start http://localhost:3000')
    } else {
        childProcess.exec('open http://localhost:3000')
    }
})
